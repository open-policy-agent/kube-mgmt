suite: lint service
templates:
  - service.yaml
tests:
  - it: fails when service annotation is boolean
    set:
      service:
        annotations:
          bar: true
    asserts:
      - failedTemplate:
          errorPattern: "got boolean, want string"

  - it: fails when service annotation is array
    set:
      service:
        annotations:
          baz: ["invalid"]
    asserts:
      - failedTemplate:
          errorPattern: "got array, want string"

  - it: fails when service annotation is object
    set:
      service:
        annotations:
          foo:
            bar: baz
    asserts:
      - failedTemplate:
          errorPattern: "got object, want string"

  - it: trafficDistribution invalid value
    set:
      service:
        trafficDistribution: "InvalidValue"
    asserts:
      - failedTemplate:
          errorMessage: |
            values don't meet the specifications of the schema(s) in the following chart(s):
            opa-kube-mgmt:
            - at '/service/trafficDistribution': value must be one of 'PreferClose', 'PreferSameNode', 'PreferSameZone', <nil>
